{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "HMH Into Math TX - Content Block Structure",
  "description": "Complete lesson structure schema based on Content Block Output List",
  "type": "object",
  "required": ["lesson_metadata", "before_you_teach", "learning_goal", "spark_your_learning", "tasks", "review_syl", "quick_check", "practice"],
  "properties": {
    "lesson_metadata": {
      "type": "object",
      "required": ["grade", "module", "lesson", "title"],
      "properties": {
        "grade": {"type": "string", "enum": ["K", "1", "2", "3", "4", "5", "6", "7", "8", "A1"]},
        "module": {"type": "integer"},
        "lesson": {"type": "integer"},
        "title": {"type": "string"},
        "version": {"type": "string", "default": "v2"}
      }
    },

    "before_you_teach": {
      "type": "object",
      "description": "Teacher Edition only - conceptual depth and planning",
      "required": ["understand_math", "prior_learning", "focus_standard", "elps", "learning_objective", "language_objective", "future_connections"],
      "properties": {
        "understand_math": {
          "type": "array",
          "description": "What should I understand about the math? (≤420 chars total)",
          "minItems": 3,
          "maxItems": 3,
          "items": {"type": "string", "maxLength": 140}
        },
        "prior_learning": {
          "type": "array",
          "description": "3 bullets, past tense, lowercase starts",
          "minItems": 3,
          "maxItems": 3,
          "items": {"type": "string"}
        },
        "focus_standard": {"type": "string", "description": "TEKS verbatim"},
        "elps": {"type": "string", "description": "ELPS code + text"},
        "learning_objective": {"type": "string"},
        "language_objective": {"type": "string"},
        "future_connections": {
          "type": "array",
          "description": "3 bullets, 'will...' phrasing",
          "minItems": 3,
          "maxItems": 3,
          "items": {"type": "string"}
        },
        "manipulatives": {
          "type": "object",
          "properties": {
            "per_student": {"type": "array", "items": {"type": "string"}},
            "per_group": {"type": "array", "items": {"type": "string"}},
            "digital": {"type": "array", "items": {"type": "string"}}
          }
        }
      }
    },

    "learning_goal": {
      "type": "object",
      "required": ["student_edition", "teacher_edition"],
      "properties": {
        "student_edition": {
          "type": "object",
          "required": ["i_can_statement", "rating_scale"],
          "properties": {
            "i_can_statement": {"type": "string", "description": "Student-friendly, bold vocab"},
            "rating_scale": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["I don't understand yet", "I need more practice", "I've got it"]
              }
            }
          }
        },
        "teacher_edition": {
          "type": "object",
          "required": ["boilerplate", "vocab_clarification", "steps"],
          "properties": {
            "boilerplate": {"type": "string", "const": "START"},
            "vocab_clarification": {
              "type": "array",
              "description": "1-2 vocabulary terms",
              "minItems": 1,
              "maxItems": 2,
              "items": {"type": "string"}
            },
            "steps": {
              "type": "array",
              "description": "3-5 steps minimum",
              "minItems": 3,
              "maxItems": 5,
              "items": {"type": "string"}
            }
          }
        }
      }
    },

    "spark_your_learning": {
      "type": "object",
      "required": ["student_edition", "teacher_edition"],
      "properties": {
        "student_edition": {
          "type": "object",
          "required": ["problem", "turn_and_talk"],
          "properties": {
            "problem": {
              "type": "object",
              "required": ["text"],
              "properties": {
                "text": {"type": "string", "maxLength": 600, "description": "≤120 words, ~5 chars/word"},
                "spec_type": {"type": "string", "enum": ["art", "photo", "tech art", "hybrid"]},
                "spec_description": {"type": "string"},
                "alt_text": {"type": "string"}
              }
            },
            "turn_and_talk": {
              "type": "object",
              "required": ["text"],
              "properties": {
                "text": {"type": "string"},
                "annotation": {"type": "string"}
              }
            }
          }
        },
        "teacher_edition": {
          "type": "object",
          "required": ["boilerplate", "three_reads", "spark_discussions", "turn_and_talk_guide", "ml_scaffolds", "udl_strategy", "vocab_clarification"],
          "properties": {
            "boilerplate": {"type": "string", "const": "START"},
            "three_reads": {
              "type": "object",
              "description": "MLR6: Three Reads routine",
              "required": ["read1_context", "read2_quantities", "read3_question"],
              "properties": {
                "read1_context": {"type": "string"},
                "read2_quantities": {"type": "string"},
                "read3_question": {"type": "string"}
              }
            },
            "spark_discussions": {
              "type": "object",
              "required": ["common_error", "deepening_thinking"],
              "properties": {
                "common_error": {
                  "type": "object",
                  "required": ["student_example", "teacher_script", "ask_questions"],
                  "properties": {
                    "student_example": {"type": "string"},
                    "teacher_script": {"type": "string"},
                    "ask_questions": {
                      "type": "array",
                      "minItems": 3,
                      "items": {
                        "type": "object",
                        "required": ["question", "possible_answer"],
                        "properties": {
                          "question": {"type": "string"},
                          "possible_answer": {"type": "string"}
                        }
                      }
                    },
                    "spec_type": {"type": "string", "enum": ["art", "photo", "tech art"]},
                    "spec_description": {"type": "string"}
                  }
                },
                "deepening_thinking": {
                  "type": "object",
                  "required": ["student_example", "teacher_script", "ask_questions"],
                  "properties": {
                    "student_example": {"type": "string"},
                    "teacher_script": {"type": "string"},
                    "ask_questions": {
                      "type": "array",
                      "minItems": 3,
                      "items": {
                        "type": "object",
                        "required": ["question", "possible_answer"],
                        "properties": {
                          "question": {"type": "string"},
                          "possible_answer": {"type": "string"}
                        }
                      }
                    }
                  }
                }
              }
            },
            "turn_and_talk_guide": {"type": "string"},
            "ml_scaffolds": {
              "type": "object",
              "required": ["emerging", "expanding", "bridging"],
              "properties": {
                "emerging": {"type": "string", "description": "Pre-Production/Beginning level"},
                "expanding": {"type": "string", "description": "Intermediate level"},
                "bridging": {"type": "string", "description": "High Intermediate/Advanced level"}
              }
            },
            "udl_strategy": {
              "type": "object",
              "required": ["principle", "description"],
              "properties": {
                "principle": {"type": "string", "enum": ["Engagement", "Representation", "Action & Expression"]},
                "description": {"type": "string"}
              }
            },
            "vocab_clarification": {"type": "string"}
          }
        }
      }
    },

    "tasks": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["task_number", "student_edition", "teacher_edition"],
        "properties": {
          "task_number": {"type": "integer"},
          "student_edition": {
            "type": "object",
            "required": ["problem_stem", "sub_items"],
            "properties": {
              "problem_stem": {"type": "string", "maxLength": 750, "description": "≤150 words"},
              "new_vocabulary": {"type": "array", "items": {"type": "string"}},
              "sub_items": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "object",
                  "required": ["label", "text"],
                  "properties": {
                    "label": {"type": "string", "pattern": "^[A-Z]$"},
                    "text": {"type": "string"},
                    "annotation": {"type": "string"},
                    "spec_type": {"type": "string", "enum": ["art", "photo", "tech art"]},
                    "spec_description": {"type": "string"},
                    "alt_text": {"type": "string"}
                  }
                }
              },
              "turn_and_talk": {
                "type": "object",
                "properties": {
                  "text": {"type": "string"},
                  "annotation": {"type": "string"}
                }
              }
            }
          },
          "teacher_edition": {
            "type": "object",
            "required": ["boilerplate", "tg_questions", "process_standard", "solve_boilerplate"],
            "properties": {
              "boilerplate": {"type": "string", "const": "START"},
              "three_reads_or_mlr": {"type": "string", "description": "MLR6 Three Reads or other MLR"},
              "tg_questions": {
                "type": "array",
                "description": "≤5 questions per sub-item",
                "items": {
                  "type": "object",
                  "required": ["item", "question", "possible_answer"],
                  "properties": {
                    "item": {"type": "string", "description": "A, B, C, etc."},
                    "question": {"type": "string"},
                    "possible_answer": {"type": "string"},
                    "annotation": {"type": "string"}
                  }
                }
              },
              "process_standard": {
                "type": "object",
                "required": ["boilerplate", "text", "support_notes"],
                "properties": {
                  "boilerplate": {"type": "string", "const": "NEXT"},
                  "text": {"type": "string", "description": "Texas Process Standard verbatim"},
                  "support_notes": {"type": "string"}
                }
              },
              "solve_boilerplate": {"type": "string", "const": "NOW, have students solve the problem"},
              "turn_and_talk_guide": {"type": "string"},
              "mlr": {
                "type": "object",
                "properties": {
                  "routine": {"type": "string", "description": "Which MLR"},
                  "alignment": {"type": "string", "description": "Aligned to last item"}
                }
              },
              "supports": {
                "type": "object",
                "properties": {
                  "ml_support": {"type": "string"},
                  "udl_support": {"type": "string"},
                  "common_error": {"type": "string"},
                  "item_alignment": {"type": "string"}
                }
              },
              "dok_questions": {
                "type": "object",
                "description": "Task 1 ONLY",
                "properties": {
                  "level_1_recall": {
                    "type": "array",
                    "items": {"type": "object", "properties": {"question": {"type": "string"}, "annotation": {"type": "string"}}}
                  },
                  "level_2_application": {
                    "type": "array",
                    "items": {"type": "object", "properties": {"question": {"type": "string"}, "annotation": {"type": "string"}}}
                  },
                  "level_3_strategic": {
                    "type": "array",
                    "items": {"type": "object", "properties": {"question": {"type": "string"}, "annotation": {"type": "string"}}}
                  }
                }
              }
            }
          }
        }
      }
    },

    "review_syl": {
      "type": "object",
      "required": ["student_edition", "teacher_edition"],
      "properties": {
        "student_edition": {
          "type": "object",
          "required": ["restated_problem", "reflection_question"],
          "properties": {
            "restated_problem": {"type": "string", "description": "Shortened form of SYL problem"},
            "reflection_question": {"type": "string"},
            "spec_type": {"type": "string"},
            "spec_description": {"type": "string"},
            "alt_text": {"type": "string"}
          }
        },
        "teacher_edition": {
          "type": "object",
          "required": ["boilerplate", "ask_questions", "mlr", "turn_and_talk"],
          "properties": {
            "boilerplate": {"type": "string", "const": "NOW, review Spark Your Learning"},
            "ask_questions": {
              "type": "array",
              "minItems": 3,
              "items": {
                "type": "object",
                "required": ["question", "possible_answer"],
                "properties": {
                  "question": {"type": "string"},
                  "possible_answer": {"type": "string"}
                }
              }
            },
            "mlr": {"type": "string", "description": "Aligned to last item"},
            "turn_and_talk": {"type": "string"},
            "feedback_note": {"type": "string"},
            "ml_support": {"type": "string"}
          }
        }
      }
    },

    "quick_check": {
      "type": "object",
      "required": ["student_edition", "teacher_edition"],
      "properties": {
        "student_edition": {
          "type": "object",
          "required": ["interactions"],
          "properties": {
            "interactions": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "required": ["number", "manuscript"],
                "properties": {
                  "number": {"type": "integer"},
                  "manuscript": {"type": "string"},
                  "annotation": {"type": "string"},
                  "spec_type": {"type": "string"},
                  "spec_description": {"type": "string"},
                  "alt_text": {"type": "string"}
                }
              }
            }
          }
        },
        "teacher_edition": {
          "type": "object",
          "required": ["boilerplate", "language_objective_ref", "ml_strategy"],
          "properties": {
            "boilerplate": {"type": "string", "const": "NOW, use the Quick Check"},
            "language_objective_ref": {"type": "string"},
            "ml_strategy": {
              "type": "object",
              "required": ["elps_alignment", "strategy"],
              "properties": {
                "elps_alignment": {"type": "string"},
                "strategy": {"type": "string"},
                "sentence_frames": {"type": "array", "items": {"type": "string"}},
                "word_bank": {"type": "array", "items": {"type": "string"}}
              }
            },
            "optional_supports": {
              "type": "object",
              "properties": {
                "udl": {"type": "string"},
                "common_error": {"type": "string"}
              }
            }
          }
        }
      }
    },

    "practice": {
      "type": "object",
      "required": ["practice_on_your_own"],
      "properties": {
        "practice_on_your_own": {
          "type": "object",
          "required": ["student_edition", "teacher_edition"],
          "properties": {
            "student_edition": {
              "type": "object",
              "required": ["syl_problem", "interactions"],
              "properties": {
                "syl_problem": {
                  "type": "object",
                  "description": "Same as original SYL problem",
                  "properties": {
                    "text": {"type": "string"},
                    "spec_type": {"type": "string"},
                    "spec_description": {"type": "string"},
                    "alt_text": {"type": "string"}
                  }
                },
                "interactions": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["number", "manuscript"],
                    "properties": {
                      "number": {"type": "integer"},
                      "manuscript": {"type": "string"},
                      "annotation": {"type": "string"},
                      "spec_type": {"type": "string"},
                      "spec_description": {"type": "string"},
                      "alt_text": {"type": "string"}
                    }
                  }
                }
              }
            },
            "teacher_edition": {
              "type": "object",
              "required": ["teacher_guide", "item_guide", "rubrics"],
              "properties": {
                "teacher_guide": {"type": "string", "description": "No subsection"},
                "ml_strategy": {"type": "string"},
                "item_guide": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["item_number", "dok_level", "task_alignment"],
                    "properties": {
                      "item_number": {"type": "string", "description": "e.g., '3a'"},
                      "dok_level": {"type": "integer", "minimum": 1, "maximum": 3},
                      "task_alignment": {"type": "string", "description": "e.g., 'Task 2'"}
                    }
                  }
                },
                "rubrics": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["item", "scale"],
                    "properties": {
                      "item": {"type": "string"},
                      "scale": {
                        "type": "object",
                        "required": ["2_points", "1_point", "0_points"],
                        "properties": {
                          "2_points": {"type": "string", "description": "Complete/correct with explanation"},
                          "1_point": {"type": "string", "description": "Partial or minor errors"},
                          "0_points": {"type": "string", "description": "Incorrect or incomplete"}
                        }
                      },
                      "sample_answers": {
                        "type": "object",
                        "properties": {
                          "2_points_example": {"type": "string"},
                          "1_point_example": {"type": "string"}
                        }
                      },
                      "rubric_type": {"type": "string", "enum": ["modeling", "visual", "computational", "written"], "description": "At least one must be modeling or visual"}
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
